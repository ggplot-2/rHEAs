---
title: "Big data anylysis methods employed in the research of high-entropy alloys "
subtitle: "Text mining & Visualization with R"
author: "Dinghao Miao"
date: "2017-03-17"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: false
      countIncrementalSlides: false
---
class: center, middle

#Outline
## 1. Data Science & Materials Science
## 2. Text Mining and Visualization 
## 3. Introduction to R
---
class: inverse, center, middle

# Get Started

---
class:  center, middle
# Data Model

---
class:  center, middle
## Element frequency
---
class:  middle
```{r}
#### Import alloy data ####
rm(list = ls())
library(dplyr)
alloy <- tbl_df(read.table("./Data/High-entropy alloy system - 工作表4.csv", 
                    header = TRUE, 
                    sep = ",",
                    colClasses = "character",
                    encoding = "UTF-8"))
```
---
class:  middle
```{r}
#### Remove unexpected syntax ####
library(stringr)
N <- dim(alloy)[1]
for (i in 1:N){
  
  alloy[i, 1] <- str_replace_all(alloy[i, 1],
                                 "([A-Z])",
                                 "\\-\\1")
  alloy[i, 1] <- str_replace_all(alloy[i, 1],
                                 "[0-9|.|x|(|)]",
                                 "-")
  alloy[i, 1] <- str_replace_all(alloy[i, 1],
                                 "-+",
                                 " ")
}
alloy <- distinct(alloy) # Remove repeated observation
```
---
class:  middle
```{r}
#### Tidy data & calculate element frequency ####
N <- dim(alloy)[1]
alloy <- mutate(alloy, line = 1:N)
library(tidytext)
library(wordcloud)
td_alloy <- alloy %>%
  unnest_tokens(element, Alloy, to_lower = FALSE)
td_alloy
```
---
class:  middle
```{r}
td_alloy %>%
  count(element, sort = TRUE) %>%
  with(wordcloud(element, n, random.order = FALSE,
                 # random.color = TRUE,
                 colors = "red",
                 rot.per = 0,
                 ordered.colors = TRUE))

```

----
class:  middle
```{r}
frequency <- td_alloy %>%
  count(element, sort = TRUE) %>%
  mutate(other = n / sum(n)) %>%
  ungroup()
periodic <- read.table("periodic-table.csv",
                       header = TRUE,
                       sep = ",") 
# td_alloy$element <- factor(td_alloy$element, periodic$atomic_symbol)
frequency$element <- factor(frequency$element, periodic$atomic_symbol)
library(scales)
library(ggplot2)

```
---
class:  middle
```{r}
ggplot(frequency, aes(x = element, y = other)) +
  geom_point() +
  geom_hline(yintercept = 0.025) +
  geom_vline(xintercept = 4.5) + 
  geom_vline(xintercept = 19.5) +
  geom_text(aes(label = element), check_overlap = TRUE, vjust = -1.0) +
  theme(legend.position="none") +
  labs(y = "Frequency", x = "E")
```
---
class:   middle
## Clustering of HEAs system
---
```{r}
#### Group & Order td_alloy ####
td_alloy <- td_alloy %>%
  arrange(line, element) %>%
  group_by(line)
# td_alloy$element <- as.character.factor(td_alloy$element)
#### Rename HEAs ####
for(i in 1:N) {
  temp <- filter(td_alloy, line == i)
  Alloy_newname <- temp[1, 2]
  for(j in 1:(dim(temp)[1]-1)) {
   Alloy_newname <- str_c(Alloy_newname, "-", temp[j+1, 2]) 
  }
  # alloy[i, 1] <- Alloy_newname
  td_alloy$Alloy[td_alloy$line == i] <- Alloy_newname
}
```
---
class:  middle
```{r}

alloy

```
---
```{r}
td_alloy
```

---
class:  middle
```{r}
#### Cluster HEAs ####
# library(cluster)
library(tm)
library(cluster)
print(dtm <- cast_dtm(td_alloy, Alloy, element, line))
# #K-means method
# HEAs_kmeans <- pam(dtm, 7)
# table(HEAs_kmeans$clustering)
#Hierarchical clustering
library(proxy)
d <- dist(as.matrix(dtm), method="cosine")
hc <- hclust(d, method="single")
```

---
class:  middle
```{r}
library(ape)
plot(as.phylo(hc), type = "fan", tip.color = hsv(runif(15, 0.65, 
    0.95), 1, 1, 0.7), edge.color = hsv(runif(10, 0.65, 0.75), 1, 1, 0.7), edge.width = runif(20, 
    0.5, 3), use.edge.length = TRUE, col = "gray80")
```


---

class: center, middle

# Thanks!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

